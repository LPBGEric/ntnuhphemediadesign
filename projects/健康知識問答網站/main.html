<!DOCTYPE html>
<html lang="zh-TW">
<!-- å‰é¢çš„ head å’Œ style éƒ¨åˆ†ä¿æŒä¸è®Š -->
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å¥åº·çŸ¥è­˜å•ç­”</title>
    <style>
        /* åŸæœ‰çš„æ‰€æœ‰ CSS æ¨£å¼ä¿æŒä¸è®Š */
        body {
            font-family: 'Microsoft JhengHei', sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f0f8ff;
        }
        .container {
            background-color: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        button {
            background-color: #4CAF50;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
            font-size: 16px;
        }
        button:hover {
            background-color: #45a049;
        }
        button:disabled {
            background-color: #cccccc;
            cursor: not-allowed;
        }
        .controls {
            margin: 20px 0;
        }
        #result {
            margin: 20px 0;
            padding: 10px;
            border-radius: 5px;
        }
        .correct {
            background-color: #dff0d8;
            color: #3c763d;
        }
        .incorrect {
            background-color: #f2dede;
            color: #a94442;
        }
        #status {
            margin: 10px 0;
            padding: 10px;
            border-radius: 5px;
            font-style: italic;
        }
        .recording {
            background-color: #ffe6e6;
            animation: pulse 1.5s infinite;
        }
        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.5; }
            100% { opacity: 1; }
        }
        .microphone-icon {
            display: inline-block;
            width: 20px;
            height: 20px;
            margin-right: 5px;
            vertical-align: middle;
        }
        /* æ–°å¢ï¼šé€²åº¦é¡¯ç¤ºæ¨£å¼ */
        #progress {
            margin: 10px 0;
            font-size: 14px;
            color: #666;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>å¥åº·çŸ¥è­˜å•ç­”</h1>
        <div id="progress"></div>
        <div id="question"></div>
        <div class="controls">
            <button id="startVoice">
                <span id="micIcon">ğŸ¤</span>
                é–‹å§‹èªéŸ³è¼¸å…¥
            </button>
            <button id="stopVoice" disabled>åœæ­¢èªéŸ³è¼¸å…¥</button>
            <button id="checkAnswer">æª¢æŸ¥ç­”æ¡ˆ</button>
            <button id="nextQuestion">ä¸‹ä¸€é¡Œ</button>
        </div>
        <div id="status"></div>
        <input type="text" id="answerInput" placeholder="åœ¨æ­¤è¼¸å…¥ç­”æ¡ˆæˆ–ä½¿ç”¨èªéŸ³è¼¸å…¥" style="width: 100%; padding: 10px; margin: 10px 0;">
        <div id="result"></div>
    </div>

    <script>
        const questions = [
            {
                question: "æ¯å¤©å»ºè­°å–å¤šå°‘æ°´ï¼Ÿ",
                answer: "2000æ¯«å‡",
                alternatives: ["2å…¬å‡", "å…©å…¬å‡", "2000cc"]
            },
            {
                question: "æˆäººæ¯å¤©å»ºè­°é‹å‹•æ™‚é–“æ˜¯å¤šå°‘ï¼Ÿ",
                answer: "30åˆ†é˜",
                alternatives: ["åŠå°æ™‚", "0.5å°æ™‚"]
            },
            {
                question: "å¥åº·çš„ç¡çœ æ™‚é–“å»ºè­°æ˜¯å¤šå°‘å°æ™‚ï¼Ÿ",
                answer: "7-9å°æ™‚",
                alternatives: ["ä¸ƒåˆ°ä¹å°æ™‚", "7åˆ°9å°æ™‚"]
            },
            {
                question: "ç†æƒ³çš„èº«é«”è³ªé‡æŒ‡æ•¸ï¼ˆBMIï¼‰ç¯„åœæ˜¯å¤šå°‘ï¼Ÿ",
                answer: "18.5-24",
                alternatives: ["18.5åˆ°24", "18.5è‡³24"]
            },
            {
                question: "æˆäººçš„æ­£å¸¸è¡€å£“ç¯„åœæ˜¯å¤šå°‘ï¼Ÿ",
                answer: "120/80",
                alternatives: ["120æ¯”80", "æ”¶ç¸®å£“120èˆ’å¼µå£“80"]
            },
            {
                question: "æ¯å¤©å»ºè­°æ”å–çš„è”¬èœä»½é‡æ˜¯å¤šå°‘ï¼Ÿ",
                answer: "3ä»½",
                alternatives: ["ä¸‰ä»½", "3ä»½è”¬èœ"]
            },
            {
                question: "æˆäººæ¯é€±å»ºè­°é‹å‹•å¹¾å¤©ï¼Ÿ",
                answer: "3-5å¤©",
                alternatives: ["ä¸‰åˆ°äº”å¤©", "3è‡³5å¤©"]
            },
            {
                question: "æ¯å¤©å»ºè­°çš„æ°´æœæ”å–é‡æ˜¯å¤šå°‘ä»½ï¼Ÿ",
                answer: "2ä»½",
                alternatives: ["å…©ä»½", "2ä»½æ°´æœ"]
            },
            {
                question: "æˆäººç©ºè…¹è¡€ç³–çš„æ­£å¸¸å€¼æ˜¯å¤šå°‘ï¼Ÿ",
                answer: "100ä»¥ä¸‹",
                alternatives: ["å°æ–¼100", "100mg/dLä»¥ä¸‹"]
            },
            {
                question: "å»ºè­°å¤šä¹…æ¸¬é‡ä¸€æ¬¡é«”é‡ï¼Ÿ",
                answer: "æ¯é€±ä¸€æ¬¡",
                alternatives: ["ä¸€é€±ä¸€æ¬¡", "é€±ä¸€æ¬¡"]
            },
            {
                question: "ç†æƒ³çš„è…°åœæ¨™æº–ï¼Œç”·æ€§æ‡‰è©²å°æ–¼å¹¾å…¬åˆ†ï¼Ÿ",
                answer: "90å…¬åˆ†",
                alternatives: ["90cm", "ä¹åå…¬åˆ†"]
            },
            {
                question: "ç†æƒ³çš„è…°åœæ¨™æº–ï¼Œå¥³æ€§æ‡‰è©²å°æ–¼å¹¾å…¬åˆ†ï¼Ÿ",
                answer: "80å…¬åˆ†",
                alternatives: ["80cm", "å…«åå…¬åˆ†"]
            },
            {
                question: "æ¯é¤æ‡‰è©²å¤šä¹…åƒå®Œæ¯”è¼ƒå¥åº·ï¼Ÿ",
                answer: "20åˆ†é˜",
                alternatives: ["äºŒååˆ†é˜", "20åˆ†"]
            },
            {
                question: "ä¸€èˆ¬å»ºè­°å¹¾æ­²é–‹å§‹å®šæœŸåšå¥åº·æª¢æŸ¥ï¼Ÿ",
                answer: "40æ­²",
                alternatives: ["å››åæ­²", "40"]
            },
            {
                question: "å»ºè­°æ¯å¤©èµ°å¹¾æ­¥è·¯æœ€å¥½ï¼Ÿ",
                answer: "10000æ­¥",
                alternatives: ["ä¸€è¬æ­¥", "10000"]
            }
        ];

        let currentQuestionIndex = 0;
        let isRecording = false;
        let recognition = null;
        const synthesis = window.speechSynthesis;

        // å…¶é¤˜ JavaScript å‡½æ•¸ä¿æŒä¸è®Šï¼Œåªæ–°å¢æ›´æ–°é€²åº¦çš„å‡½æ•¸
        function updateProgress() {
            const progressElement = document.getElementById('progress');
            progressElement.textContent = `é€²åº¦ï¼š${currentQuestionIndex + 1} / ${questions.length}`;
        }

        // ä¿®æ”¹ displayQuestion å‡½æ•¸ï¼ŒåŠ å…¥é€²åº¦æ›´æ–°
        function displayQuestion() {
            const questionElement = document.getElementById('question');
            questionElement.innerHTML = `<h2>å•é¡Œ ${currentQuestionIndex + 1}ï¼š${questions[currentQuestionIndex].question}</h2>`;
            document.getElementById('answerInput').value = '';
            document.getElementById('result').innerHTML = '';
            showStatus('æº–å‚™å°±ç·’', '');
            updateProgress();
        }

        // å…¶é¤˜æ‰€æœ‰å‡½æ•¸ä¿æŒä¸è®Š
        function initializeSpeechRecognition() {
            const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
            if (!SpeechRecognition) {
                alert('æ‚¨çš„ç€è¦½å™¨ä¸æ”¯æ´èªéŸ³è¾¨è­˜åŠŸèƒ½ï¼Œè«‹ä½¿ç”¨Chromeç€è¦½å™¨ã€‚');
                document.getElementById('startVoice').disabled = true;
                return null;
            }

            const recognition = new SpeechRecognition();
            recognition.lang = 'zh-TW';
            recognition.continuous = true;
            recognition.interimResults = true;
           
            recognition.onstart = () => {
                isRecording = true;
                updateUI();
                showStatus('æ­£åœ¨è†è½...', 'recording');
            };

            recognition.onend = () => {
                isRecording = false;
                updateUI();
                if (!document.getElementById('answerInput').value) {
                    showStatus('æœªæª¢æ¸¬åˆ°èªéŸ³ï¼Œè«‹é‡è©¦', 'error');
                }
            };

            recognition.onresult = (event) => {
                let finalTranscript = '';
                let interimTranscript = '';

                for (let i = event.resultIndex; i < event.results.length; i++) {
                    const transcript = event.results[i][0].transcript;
                    if (event.results[i].isFinal) {
                        finalTranscript += transcript;
                    } else {
                        interimTranscript += transcript;
                    }
                }

                if (finalTranscript) {
                    document.getElementById('answerInput').value = finalTranscript;
                    showStatus('å·²æ¥æ”¶èªéŸ³è¼¸å…¥', 'success');
                } else if (interimTranscript) {
                    document.getElementById('answerInput').value = interimTranscript;
                    showStatus('æ­£åœ¨è™•ç†èªéŸ³...', 'processing');
                }
            };

            recognition.onerror = (event) => {
                console.error('èªéŸ³è¾¨è­˜éŒ¯èª¤:', event.error);
                let errorMessage = 'èªéŸ³è¾¨è­˜ç™¼ç”ŸéŒ¯èª¤';
                switch (event.error) {
                    case 'no-speech':
                        errorMessage = 'æœªæª¢æ¸¬åˆ°èªéŸ³ï¼Œè«‹é‡è©¦';
                        break;
                    case 'audio-capture':
                        errorMessage = 'ç„¡æ³•å­˜å–éº¥å…‹é¢¨';
                        break;
                    case 'not-allowed':
                        errorMessage = 'è«‹å…è¨±ä½¿ç”¨éº¥å…‹é¢¨æ¬Šé™';
                        break;
                }
                showStatus(errorMessage, 'error');
                isRecording = false;
                updateUI();
            };

            return recognition;
        }

        function showStatus(message, type) {
            const statusElement = document.getElementById('status');
            statusElement.textContent = message;
            statusElement.className = type;
        }

        function updateUI() {
            const startButton = document.getElementById('startVoice');
            const stopButton = document.getElementById('stopVoice');
            const micIcon = document.getElementById('micIcon');

            startButton.disabled = isRecording;
            stopButton.disabled = !isRecording;
           
            if (isRecording) {
                document.getElementById('status').classList.add('recording');
                micIcon.textContent = 'âº';
            } else {
                document.getElementById('status').classList.remove('recording');
                micIcon.textContent = 'ğŸ¤';
            }
        }

        function init() {
            recognition = initializeSpeechRecognition();
            displayQuestion();
            setupEventListeners();
        }

        function setupEventListeners() {
            document.getElementById('startVoice').addEventListener('click', startVoiceInput);
            document.getElementById('stopVoice').addEventListener('click', stopVoiceInput);
            document.getElementById('checkAnswer').addEventListener('click', checkAnswer);
            document.getElementById('nextQuestion').addEventListener('click', nextQuestion);
        }

        function startVoiceInput() {
            if (!recognition) {
                showStatus('ç€è¦½å™¨ä¸æ”¯æ´èªéŸ³è¾¨è­˜', 'error');
                return;
            }
            try {
                recognition.start();
            } catch (error) {
                console.error('é–‹å§‹èªéŸ³è¾¨è­˜æ™‚ç™¼ç”ŸéŒ¯èª¤:', error);
                showStatus('ç„¡æ³•å•Ÿå‹•èªéŸ³è¾¨è­˜ï¼Œè«‹é‡è©¦', 'error');
            }
        }

        function stopVoiceInput() {
            if (recognition) {
                recognition.stop();
                showStatus('èªéŸ³è¼¸å…¥å·²åœæ­¢', '');
            }
        }

        function checkAnswer() {
            const userAnswer = document.getElementById('answerInput').value.trim();
            if (!userAnswer) {
                showStatus('è«‹è¼¸å…¥ç­”æ¡ˆ', 'error');
                return;
            }

            const currentQuestion = questions[currentQuestionIndex];
            const isCorrect = [currentQuestion.answer, ...currentQuestion.alternatives]
                .some(answer => userAnswer.toLowerCase() === answer.toLowerCase());

            const resultElement = document.getElementById('result');
            resultElement.className = isCorrect ? 'correct' : 'incorrect';
           
            const resultMessage = isCorrect ?
                `æ­£ç¢ºï¼ç­”æ¡ˆæ˜¯${currentQuestion.answer}` :
                `ä¸æ­£ç¢ºã€‚æ­£ç¢ºç­”æ¡ˆæ˜¯${currentQuestion.answer}`;
           
            resultElement.textContent = resultMessage;

            const utterance = new SpeechSynthesisUtterance(resultMessage);
            utterance.lang = 'zh-TW';
            synthesis.speak(utterance);
        }

        function nextQuestion() {
            currentQuestionIndex = (currentQuestionIndex + 1) % questions.length;
            displayQuestion();
        }

        init();
    </script>
</body>
</html>