<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>èªéŸ³å¥åº·ç›®æ¨™è¿½è¹¤</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            padding: 0;
        }
        .container {
            max-width: 600px;
            margin: auto;
        }
        h1 {
            text-align: center;
        }
        button {
            padding: 10px 20px;
            margin: 10px 0;
            font-size: 16px;
            background-color: #4CAF50;
            color: white;
            border: none;
            cursor: pointer;
        }
        button:hover {
            background-color: #45a049;
        }
        textarea, input {
            width: 100%;
            padding: 10px;
            margin: 10px 0;
            border: 1px solid #ccc;
            border-radius: 4px;
        }
        .output {
            margin: 10px 0;
            padding: 10px;
            border: 1px solid #ccc;
            background: #f9f9f9;
            border-radius: 4px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>èªéŸ³å¥åº·ç›®æ¨™è¿½è¹¤</h1>
        <button id="recordButton">ğŸ™ï¸ é–‹å§‹éŒ„éŸ³</button>
        <div id="status">æº–å‚™éŒ„éŸ³...</div>
        
        <h2>è¨­å®šå¥åº·ç›®æ¨™</h2>
        <textarea id="goalInput" placeholder="è«‹è¼¸å…¥æˆ–èªªå‡ºæ‚¨çš„å¥åº·ç›®æ¨™ï¼Œä¾‹å¦‚ã€æ¯é€±è·‘æ­¥3æ¬¡ï¼Œæ¯æ¬¡3å…¬é‡Œã€"></textarea>
        <button onclick="setGoal()">è¨­å®šç›®æ¨™</button>
        
        <h2>é€²åº¦æ›´æ–°</h2>
        <textarea id="progressInput" placeholder="è«‹è¼¸å…¥æˆ–èªªå‡ºæ‚¨çš„é€²åº¦ï¼Œä¾‹å¦‚ã€ä»Šå¤©è·‘äº†3å…¬é‡Œã€"></textarea>
        <button onclick="updateProgress()">æ›´æ–°é€²åº¦</button>
        
        <h2>æŸ¥è©¢ç›®æ¨™èˆ‡é€²åº¦</h2>
        <button onclick="queryProgress()">æŸ¥è©¢é€²åº¦</button>
        <div id="output" class="output"></div>
    </div>

    <script>
        let recognition;
        let healthData = {
            goal: "",
            progress: [],
            completionRate: 0
        };

        // åˆå§‹åŒ–èªéŸ³è¾¨è­˜
        function initializeSpeechRecognition() {
            const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
            if (!SpeechRecognition) {
                alert("æ­¤ç€è¦½å™¨ä¸æ”¯æ´èªéŸ³è¾¨è­˜ã€‚è«‹ä½¿ç”¨ Chrome æˆ–å…¶ä»–æ”¯æ´ Web Speech API çš„ç€è¦½å™¨ã€‚");
                return;
            }
            recognition = new SpeechRecognition();
            recognition.lang = "zh-TW";
            recognition.interimResults = false;

            recognition.onstart = () => {
                document.getElementById("status").innerText = "éŒ„éŸ³ä¸­...";
            };

            recognition.onresult = (event) => {
                const transcript = event.results[0][0].transcript;
                document.getElementById("status").innerText = `è¾¨è­˜å®Œæˆ: ${transcript}`;
                // å°‡æ–‡å­—æ›´æ–°åˆ°ç›®æ¨™æˆ–é€²åº¦æ¬„ä½
                const goalInput = document.getElementById("goalInput");
                const progressInput = document.getElementById("progressInput");
                if (goalInput.value === "") {
                    goalInput.value = transcript;
                } else {
                    progressInput.value = transcript;
                }
            };

            recognition.onerror = (event) => {
                document.getElementById("status").innerText = "èªéŸ³è¾¨è­˜éŒ¯èª¤ï¼Œè«‹å†è©¦ä¸€æ¬¡ã€‚";
            };

            recognition.onend = () => {
                document.getElementById("status").innerText = "éŒ„éŸ³çµæŸã€‚";
            };
        }

        // é–‹å§‹éŒ„éŸ³
        document.getElementById("recordButton").addEventListener("click", () => {
            if (recognition) {
                recognition.start();
            }
        });

        // è¨­å®šç›®æ¨™
        function setGoal() {
            const goal = document.getElementById("goalInput").value.trim();
            if (!goal) {
                alert("è«‹è¼¸å…¥æˆ–èªªå‡ºæ‚¨çš„å¥åº·ç›®æ¨™ï¼");
                return;
            }
            healthData.goal = goal;
            healthData.progress = [];
            healthData.completionRate = 0;
            updateOutput(`å¥åº·ç›®æ¨™å·²è¨­å®š: ${goal}`);
        }

        // æ›´æ–°é€²åº¦
        function updateProgress() {
            const progress = document.getElementById("progressInput").value.trim();
            if (!progress) {
                alert("è«‹è¼¸å…¥æˆ–èªªå‡ºæ‚¨çš„é€²åº¦ï¼");
                return;
            }
            healthData.progress.push(progress);
            calculateCompletionRate();
            updateOutput(`é€²åº¦å·²æ›´æ–°: ${progress}`);
        }

        // è¨ˆç®—å®Œæˆç‡
        function calculateCompletionRate() {
            const goalParts = 4; // å‡è¨­ç›®æ¨™åˆ†ç‚º4éƒ¨åˆ†
            const progressCount = healthData.progress.length;
            healthData.completionRate = Math.min(100, Math.floor((progressCount / goalParts) * 100));
        }

        // æŸ¥è©¢é€²åº¦
        function queryProgress() {
            if (!healthData.goal) {
                updateOutput("å°šæœªè¨­å®šä»»ä½•å¥åº·ç›®æ¨™ï¼");
                return;
            }
            let progressText = healthData.progress.length
                ? healthData.progress.join(", ")
                : "å°šæœªæ›´æ–°ä»»ä½•é€²åº¦ã€‚";
            updateOutput(`
                ç›®æ¨™: ${healthData.goal}<br>
                é€²åº¦: ${progressText}<br>
                å®Œæˆç‡: ${healthData.completionRate}%
            `);
        }

        // æ›´æ–°ç•«é¢è¼¸å‡º
        function updateOutput(message) {
            document.getElementById("output").innerHTML = message;
        }

        // åˆå§‹åŒ–èªéŸ³è¾¨è­˜
        initializeSpeechRecognition();
    </script>
</body>
</html>
