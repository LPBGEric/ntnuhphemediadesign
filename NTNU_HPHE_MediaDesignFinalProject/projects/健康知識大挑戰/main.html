<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å¥åº·çŸ¥è­˜å•ç­”</title>
    <style>
        body {
            font-family: 'Microsoft JhengHei', sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f0f8ff;
        }
        .container {
            background-color: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        button {
            background-color: #4CAF50;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
            font-size: 16px;
        }
        button:hover {
            background-color: #45a049;
        }
        button:disabled {
            background-color: #cccccc;
            cursor: not-allowed;
        }
        .controls {
            margin: 20px 0;
        }
        #result {
            margin: 20px 0;
            padding: 10px;
            border-radius: 5px;
        }
        .correct {
            background-color: #dff0d8;
            color: #3c763d;
        }
        .incorrect {
            background-color: #f2dede;
            color: #a94442;
        }
        #status {
            margin: 10px 0;
            padding: 10px;
            border-radius: 5px;
            font-style: italic;
        }
        .recording {
            background-color: #ffe6e6;
            animation: pulse 1.5s infinite;
        }
        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.5; }
            100% { opacity: 1; }
        }
        .microphone-icon {
            display: inline-block;
            width: 20px;
            height: 20px;
            margin-right: 5px;
            vertical-align: middle;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>å¥åº·çŸ¥è­˜å•ç­”</h1>
        <div id="question"></div>
        <div class="controls">
            <button id="startVoice">
                <span id="micIcon">ğŸ¤</span>
                é–‹å§‹èªéŸ³è¼¸å…¥
            </button>
            <button id="stopVoice" disabled>åœæ­¢èªéŸ³è¼¸å…¥</button>
            <button id="checkAnswer">æª¢æŸ¥ç­”æ¡ˆ</button>
            <button id="nextQuestion">ä¸‹ä¸€é¡Œ</button>
        </div>
        <div id="status"></div>
        <input type="text" id="answerInput" placeholder="åœ¨æ­¤è¼¸å…¥ç­”æ¡ˆæˆ–ä½¿ç”¨èªéŸ³è¼¸å…¥" style="width: 100%; padding: 10px; margin: 10px 0;">
        <div id="result"></div>
    </div>

    <script>
        const questions = [
            {
                question: "æ¯å¤©å»ºè­°å–å¤šå°‘æ°´ï¼Ÿ",
                answer: "2000æ¯«å‡",
                alternatives: ["2å…¬å‡", "å…©å…¬å‡", "2000cc"]
            },
            {
                question: "æˆäººæ¯å¤©å»ºè­°é‹å‹•æ™‚é–“æ˜¯å¤šå°‘ï¼Ÿ",
                answer: "30åˆ†é˜",
                alternatives: ["åŠå°æ™‚", "0.5å°æ™‚"]
            },
            {
                question: "å¥åº·çš„ç¡çœ æ™‚é–“å»ºè­°æ˜¯å¤šå°‘å°æ™‚ï¼Ÿ",
                answer: "7-9å°æ™‚",
                alternatives: ["ä¸ƒåˆ°ä¹å°æ™‚", "7åˆ°9å°æ™‚"]
            }
        ];

        let currentQuestionIndex = 0;
        let isRecording = false;
        let recognition = null;
        const synthesis = window.speechSynthesis;

        // åˆå§‹åŒ–èªéŸ³è¾¨è­˜
        function initializeSpeechRecognition() {
            const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
            if (!SpeechRecognition) {
                alert('æ‚¨çš„ç€è¦½å™¨ä¸æ”¯æ´èªéŸ³è¾¨è­˜åŠŸèƒ½ï¼Œè«‹ä½¿ç”¨Chromeç€è¦½å™¨ã€‚');
                document.getElementById('startVoice').disabled = true;
                return null;
            }

            const recognition = new SpeechRecognition();
            recognition.lang = 'zh-TW';
            recognition.continuous = true;
            recognition.interimResults = true;
           
            recognition.onstart = () => {
                isRecording = true;
                updateUI();
                showStatus('æ­£åœ¨è†è½...', 'recording');
            };

            recognition.onend = () => {
                isRecording = false;
                updateUI();
                if (!document.getElementById('answerInput').value) {
                    showStatus('æœªæª¢æ¸¬åˆ°èªéŸ³ï¼Œè«‹é‡è©¦', 'error');
                }
            };

            recognition.onresult = (event) => {
                let finalTranscript = '';
                let interimTranscript = '';

                for (let i = event.resultIndex; i < event.results.length; i++) {
                    const transcript = event.results[i][0].transcript;
                    if (event.results[i].isFinal) {
                        finalTranscript += transcript;
                    } else {
                        interimTranscript += transcript;
                    }
                }

                if (finalTranscript) {
                    document.getElementById('answerInput').value = finalTranscript;
                    showStatus('å·²æ¥æ”¶èªéŸ³è¼¸å…¥', 'success');
                } else if (interimTranscript) {
                    document.getElementById('answerInput').value = interimTranscript;
                    showStatus('æ­£åœ¨è™•ç†èªéŸ³...', 'processing');
                }
            };

            recognition.onerror = (event) => {
                console.error('èªéŸ³è¾¨è­˜éŒ¯èª¤:', event.error);
                let errorMessage = 'èªéŸ³è¾¨è­˜ç™¼ç”ŸéŒ¯èª¤';
                switch (event.error) {
                    case 'no-speech':
                        errorMessage = 'æœªæª¢æ¸¬åˆ°èªéŸ³ï¼Œè«‹é‡è©¦';
                        break;
                    case 'audio-capture':
                        errorMessage = 'ç„¡æ³•å­˜å–éº¥å…‹é¢¨';
                        break;
                    case 'not-allowed':
                        errorMessage = 'è«‹å…è¨±ä½¿ç”¨éº¥å…‹é¢¨æ¬Šé™';
                        break;
                }
                showStatus(errorMessage, 'error');
                isRecording = false;
                updateUI();
            };

            return recognition;
        }

        // é¡¯ç¤ºç‹€æ…‹è¨Šæ¯
        function showStatus(message, type) {
            const statusElement = document.getElementById('status');
            statusElement.textContent = message;
            statusElement.className = type;
        }

        // æ›´æ–°UIç‹€æ…‹
        function updateUI() {
            const startButton = document.getElementById('startVoice');
            const stopButton = document.getElementById('stopVoice');
            const micIcon = document.getElementById('micIcon');

            startButton.disabled = isRecording;
            stopButton.disabled = !isRecording;
           
            if (isRecording) {
                document.getElementById('status').classList.add('recording');
                micIcon.textContent = 'âº';
            } else {
                document.getElementById('status').classList.remove('recording');
                micIcon.textContent = 'ğŸ¤';
            }
        }

        // åˆå§‹åŒ–
        function init() {
            recognition = initializeSpeechRecognition();
            displayQuestion();
            setupEventListeners();
        }

        // é¡¯ç¤ºå•é¡Œ
        function displayQuestion() {
            const questionElement = document.getElementById('question');
            questionElement.innerHTML = `<h2>å•é¡Œ ${currentQuestionIndex + 1}ï¼š${questions[currentQuestionIndex].question}</h2>`;
            document.getElementById('answerInput').value = '';
            document.getElementById('result').innerHTML = '';
            showStatus('æº–å‚™å°±ç·’', '');
        }

        // è¨­ç½®äº‹ä»¶ç›£è½å™¨
        function setupEventListeners() {
            document.getElementById('startVoice').addEventListener('click', startVoiceInput);
            document.getElementById('stopVoice').addEventListener('click', stopVoiceInput);
            document.getElementById('checkAnswer').addEventListener('click', checkAnswer);
            document.getElementById('nextQuestion').addEventListener('click', nextQuestion);
        }

        // é–‹å§‹èªéŸ³è¼¸å…¥
        function startVoiceInput() {
            if (!recognition) {
                showStatus('ç€è¦½å™¨ä¸æ”¯æ´èªéŸ³è¾¨è­˜', 'error');
                return;
            }
            try {
                recognition.start();
            } catch (error) {
                console.error('é–‹å§‹èªéŸ³è¾¨è­˜æ™‚ç™¼ç”ŸéŒ¯èª¤:', error);
                showStatus('ç„¡æ³•å•Ÿå‹•èªéŸ³è¾¨è­˜ï¼Œè«‹é‡è©¦', 'error');
            }
        }

        // åœæ­¢èªéŸ³è¼¸å…¥
        function stopVoiceInput() {
            if (recognition) {
                recognition.stop();
                showStatus('èªéŸ³è¼¸å…¥å·²åœæ­¢', '');
            }
        }

        // æª¢æŸ¥ç­”æ¡ˆ
        function checkAnswer() {
            const userAnswer = document.getElementById('answerInput').value.trim();
            if (!userAnswer) {
                showStatus('è«‹è¼¸å…¥ç­”æ¡ˆ', 'error');
                return;
            }

            const currentQuestion = questions[currentQuestionIndex];
            const isCorrect = [currentQuestion.answer, ...currentQuestion.alternatives]
                .some(answer => userAnswer.toLowerCase() === answer.toLowerCase());

            const resultElement = document.getElementById('result');
            resultElement.className = isCorrect ? 'correct' : 'incorrect';
           
            const resultMessage = isCorrect ?
                `æ­£ç¢ºï¼ç­”æ¡ˆæ˜¯${currentQuestion.answer}` :
                `ä¸æ­£ç¢ºã€‚æ­£ç¢ºç­”æ¡ˆæ˜¯${currentQuestion.answer}`;
           
            resultElement.textContent = resultMessage;

            // èªéŸ³è¼¸å‡ºçµæœ
            const utterance = new SpeechSynthesisUtterance(resultMessage);
            utterance.lang = 'zh-TW';
            synthesis.speak(utterance);
        }

        // ä¸‹ä¸€é¡Œ
        function nextQuestion() {
            currentQuestionIndex = (currentQuestionIndex + 1) % questions.length;
            displayQuestion();
        }

        // å•Ÿå‹•æ‡‰ç”¨
        init();
    </script>
</body>
</html>